<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SERVIS — Servicios digitales y de transporte • 30% OFF</title>

  <!-- Tailwind CDN (rápido para prototipo). En producción precompile Tailwind. -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- PayPal Hosted Buttons SDK (reemplazado según Parte 1) -->
  <script src="https://www.paypal.com/sdk/js?client-id=BAARXfxI462_701jiww4-wpnE7ekgUHOvQHPaZ6odSi6hkBC_LYBjc0QfF6pMoCppXSV2JPVqGR8Wwx58M&components=hosted-buttons&disable-funding=venmo&currency=USD"></script>
  <style>
    /* Colores que combinan con el fondo */
    :root{
      --primary-gold:#d4af37;
      --secondary-gold:#f4d03f;
      --accent-blue:#3498db;
      --warm-orange:#e67e22;
      --deep-purple:#8e44ad;
      --text-light:#f8f9fa;
      --text-dark:#2c3e50;
      --glass-light:rgba(212,175,55,0.15);
      --glass-border:rgba(244,208,63,0.25);
    }
    html,body{height:100%}
    body{
      background-image: url('FONDO.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
      background-color: #1a1a2e;
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      position: relative;
      color: var(--text-light);
    }
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(26,26,46,0.7) 0%, rgba(44,62,80,0.8) 50%, rgba(142,68,173,0.6) 100%);
      z-index: -1;
    }
    .neon-text{
      color: var(--primary-gold);
      text-shadow: 0 0 10px rgba(212,175,55,0.6), 0 0 20px rgba(244,208,63,0.4), 0 2px 4px rgba(0,0,0,0.8);
    }
    .neon-accent{
      background: linear-gradient(90deg, var(--primary-gold), var(--secondary-gold));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    .glass{
      background: linear-gradient(180deg, var(--glass-light), rgba(212,175,55,0.08));
      backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .btn-neon{
      box-shadow: 0 10px 30px rgba(212,175,55,0.2), 0 2px 8px rgba(244,208,63,0.3);
    }
    .glow-outline{
      box-shadow: 0 0 20px rgba(212,175,55,0.3);
    }
    .service-icon{
      color: var(--primary-gold);
      filter: drop-shadow(0 0 4px rgba(212,175,55,0.35));
    }
    /* small helpers */
    .fade-in{animation:fadeIn .45s ease both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
    /* responsive card grid */
    @media (min-width:1024px){.cards-grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (max-width:1023px){.cards-grid{grid-template-columns:1fr}}
    /* payment methods */
    .payment-methods {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 15px;
    }
    .payment-method {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 6px 12px;
      border-radius: 6px;
      background: rgba(212,175,55,0.15);
      border: 1px solid rgba(244,208,63,0.2);
      font-size: 14px;
      color: var(--text-light);
    }
    .payment-method img {
      width: 20px;
      height: 20px;
    }
    /* Alto contraste legible para texto sobre fondos difusos */
    .high-contrast { color:#ffffff; text-shadow:0 1px 2px rgba(0,0,0,.65); }
    .label-contrast { color:#eaf2ff; text-shadow:0 1px 1px rgba(0,0,0,.5); }
    .muted-contrast { color:#cbd5e1; }
    /* Animación de check */
    .success-animation {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(26,26,46,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .success-animation.show {
      opacity: 1;
      pointer-events: auto;
    }
    .success-check {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(145deg, var(--primary-gold), var(--secondary-gold));
      display: flex;
      align-items: center;
      justify-content: center;
      transform: scale(0);
      transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 0 30px rgba(212,175,55,0.5);
    }
    .success-animation.show .success-check {
      transform: scale(1);
    }
    .success-message {
      color: var(--primary-gold);
      font-size: 18px;
      margin-top: 20px;
      font-weight: bold;
      text-align: center;
      text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    }
    .success-content {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    /* Mejoras de interfaz */
    input, select {
      transition: all 0.3s ease;
      color: var(--text-dark);
      background: linear-gradient(145deg, rgba(248,249,250,0.95), rgba(255,255,255,0.9));
      border: 2px solid rgba(212,175,55,0.3);
      border-radius: 8px;
    }
    input:focus, select:focus {
      border-color: var(--primary-gold) !important;
      outline: none;
      box-shadow: 0 0 0 3px rgba(212,175,55,0.2), 0 0 15px rgba(244,208,63,0.3);
      background: rgba(255,255,255,0.98);
    }
    .btn-order {
      background: linear-gradient(135deg, var(--primary-gold), var(--secondary-gold));
      color: var(--text-dark);
      font-weight: 700;
      transition: all 0.3s ease;
      border: none;
      text-shadow: none;
      box-shadow: 0 4px 15px rgba(212,175,55,0.3);
    }
    .btn-order:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(212,175,55,0.4), 0 4px 15px rgba(244,208,63,0.3);
      background: linear-gradient(135deg, var(--secondary-gold), var(--primary-gold));
    }
    /* Sección de órdenes */
    .orders-section {
      margin-top: 2rem;
      padding: 1.5rem;
      border-radius: 12px;
      background: linear-gradient(180deg, var(--glass-light), rgba(212,175,55,0.08));
      backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .orders-list {
      margin-top: 1rem;
    }
    .order-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      margin-bottom: 0.5rem;
      border-radius: 8px;
      background: rgba(212,175,55,0.1);
      border-left: 4px solid var(--primary-gold);
      border: 1px solid rgba(244,208,63,0.2);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .order-status {
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      text-shadow: none;
    }
    .status-pending {
      background: linear-gradient(135deg, rgba(230,126,34,0.2), rgba(241,196,15,0.3));
      color: #f39c12;
      border: 1px solid rgba(243,156,18,0.4);
    }
    .status-completed {
      background: linear-gradient(135deg, rgba(39,174,96,0.2), rgba(46,204,113,0.3));
      color: #27ae60;
      border: 1px solid rgba(39,174,96,0.4);
    }
    .status-processing {
      background: linear-gradient(135deg, rgba(52,152,219,0.2), rgba(155,89,182,0.3));
      color: #3498db;
      border: 1px solid rgba(52,152,219,0.4);
    }
    /* Mejora de contraste para textos */
    p, h1, h2, h3, h4, h5, h6, span {
      text-shadow: 0 2px 4px rgba(0,0,0,0.8);
      color: var(--text-light);
    }
    label {
      color: var(--primary-gold);
      font-weight: 600;
      text-shadow: 0 1px 3px rgba(0,0,0,0.8);
    }
    /* Header mejorado (sticky + transición en scroll) */
    header {
      position: sticky; top: 0; z-index: 50;
      background: linear-gradient(135deg, var(--glass-light), rgba(212,175,55,0.1));
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--glass-border);
      transition: background 0.3s ease, box-shadow 0.3s ease;
    }
    header.is-sticky { box-shadow: 0 8px 24px rgba(0,0,0,0.35);
      background: linear-gradient(135deg, rgba(212,175,55,0.18), rgba(212,175,55,0.08)); }
    /* Navegación mejorada */
    nav button {
      color: var(--text-light);
      transition: all 0.3s ease;
    }
    nav button:hover, nav button.active {
      color: var(--primary-gold);
      text-shadow: 0 0 10px rgba(212,175,55,0.5);
    }
    /* Ocultar scrollbar para la nav en móvil */
    .no-scrollbar{ -ms-overflow-style: none; scrollbar-width: none; }
    .no-scrollbar::-webkit-scrollbar{ display: none; }
    /* Pill de contacto */
    .contact-pill{
      display:flex;align-items:center;gap:.25rem;color:var(--text-light);
      background: linear-gradient(180deg, rgba(212,175,55,0.12), rgba(212,175,55,0.06));
      border:1px solid var(--glass-border);
      box-shadow: 0 4px 16px rgba(0,0,0,0.25);
    }
    .contact-pill a{color:var(--primary-gold);font-weight:600}
    .contact-pill a:hover{color:var(--secondary-gold)}
    /* Efectos llamativos */
    @keyframes glowPulse{0%{box-shadow:0 8px 24px rgba(212,175,55,0.18)}50%{box-shadow:0 12px 36px rgba(212,175,55,0.35)}100%{box-shadow:0 8px 24px rgba(212,175,55,0.18)}}
    .glass:hover{transform:translateY(-2px);animation:glowPulse 1.8s ease-in-out infinite}
    .btn-order,.btn-neon{position:relative;overflow:hidden}
    .btn-order::after,.btn-neon::after{
      content:"";position:absolute;top:0;left:-120%;height:100%;width:60%;
      background:linear-gradient(115deg,transparent,rgba(255,255,255,0.35),transparent);
      transform:skewX(-18deg);
      filter:blur(2px);
    }
    .btn-order:hover::after,.btn-neon:hover::after{left:140%;transition:left .9s ease}
    .btn-order:active{transform:translateY(0) scale(0.98)}
    /* Loading state */
    .btn-order.is-loading{opacity:.9;pointer-events:none}
    .btn-order.is-loading::before{
      content:"";position:absolute;right:10px;top:50%;transform:translateY(-50%);
      width:16px;height:16px;border:2px solid rgba(0,0,0,0.35);border-top-color:var(--primary-gold);
      border-radius:50%;animation:spin .9s linear infinite;
    }
    @keyframes spin{to{transform:translateY(-50%) rotate(360deg)}}
    /* Subrayado decorativo de títulos */
    .title-underline{position:relative;display:inline-block}
    .title-underline::after{
      content:"";position:absolute;left:0;bottom:-6px;height:3px;width:100px;
      background:linear-gradient(90deg,var(--primary-gold),var(--secondary-gold));border-radius:9999px;
      box-shadow:0 0 12px rgba(212,175,55,0.5);
    }
  </style>
</head>
<body class="text-slate-200">
  <div class="max-w-[1200px] mx-auto p-6">

    <!-- HEADER -->
    <header class="flex flex-col md:flex-row items-center md:justify-between gap-3 py-4">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 rounded-lg bg-[#071028] flex items-center justify-center overflow-hidden shadow-lg">
          <!-- animated logo (SVG) -->
          <svg viewBox="0 0 100 100" class="w-10 h-10" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="lg1" x1="0" x2="1">
                <stop offset="0" stop-color="#5ee7df"/>
                <stop offset="1" stop-color="#7c4dff"/>
              </linearGradient>
            </defs>
            <rect rx="12" width="100" height="100" fill="#071028"/>
            <g transform="translate(20,20)">
              <path d="M10 8 H44 V12 L22 40 H10 Z" fill="url(#lg1)">
                <animateTransform attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="14s" repeatCount="indefinite"/>
              </path>
            </g>
          </svg>
        </div>
        <div>
          <div class="text-xl font-extrabold neon-text">SERVIS</div>
          <div class="text-xs text-slate-400">Servicios digitales y de transporte • <span class="font-semibold neon-accent">30% OFF</span></div>
        </div>
      </div>

      <nav class="hidden lg:flex items-center gap-2 overflow-x-auto no-scrollbar w-full justify-center md:justify-start">
          <div class="contact-pill glass px-3 py-2 rounded-md text-xs hidden sm:flex">
            <span>Telegram: <a id="contact-telegram" href="https://t.me/Art90z" target="_blank" class="underline hover:opacity-80">@Art90z</a></span>
            <span class="mx-2">•</span>
            <span>Correo: <a id="contact-email" href="mailto:contactrecia24@gmail.com" class="underline hover:opacity-80">contactrecia24@gmail.com</a></span>
          </div>
        </nav>

      <div class="flex items-center gap-3">
        <div class="text-right glass px-3 py-2 rounded-md">
          <div class="text-xs text-slate-400">Saldo</div>
          <div id="balance" class="font-bold">$0.00</div>
        </div>
        <div id="authArea" class="flex items-center gap-2"></div>
        <div id="currentUserBadge" class="glass px-3 py-2 rounded-md text-xs hidden">
          <span class="text-slate-400">Usuario</span>
          <span id="currentUserName" class="font-semibold ml-1"></span>
        </div>
        <button id="logoutBtn" class="btn-ghost px-3 py-2 rounded-md text-xs hidden">Cerrar sesión</button>
      </div>
    </header>

    <!-- HERO -->
    <section class="mt-6 grid lg:grid-cols-[1fr_360px] gap-6 items-start">
      <div class="p-6 glass rounded-xl">
        <h2 class="text-2xl font-bold neon-text title-underline">SERVIS – <span class="neon-accent">30% DE DESCUENTO</span> en todos los servicios</h2>
        <p class="mt-2 text-slate-400">Ahorra más, paga menos. Pagos verificados, gestión de fondos y atención 24/7 con estética futurista.</p>
        <div class="mt-5 flex gap-3">
          <button class="px-5 py-3 rounded-xl btn-neon bg-gradient-to-r from-[#7c4dff] to-[#5ee7df]" data-action="buy">Adquirir Servicio</button>
        </div>
      </div>

      <div class="p-4 glass rounded-xl">
        <div class="text-xs text-slate-400">Tu saldo disponible</div>
        <div id="balanceBig" class="text-3xl font-extrabold mt-2 neon-text">$0.00</div>
        <div class="mt-3 text-slate-400 text-sm">Usa tu saldo para pagar servicios con 30% de descuento automático.</div>
        <div class="mt-4 flex gap-2">
          <button class="px-3 py-2 rounded-md glass" data-link="recarga">Recargar</button>
          <button class="px-3 py-2 rounded-md glass" data-link="historial">Historial</button>
        </div>
      </div>
    </section>

    <!-- PANEL LAYOUT -->
    <div class="mt-6 grid lg:grid-cols-[220px_1fr] gap-6 items-start">
      <!-- Sidebar Panel -->
      <aside class="glass rounded-xl p-4 hidden lg:block">
        <div class="text-xs text-slate-400 mb-2">Panel</div>
        <div class="flex flex-col gap-2">
          <button class="px-3 py-2 rounded-md glass text-left" data-link="services">Servicios</button>
          <button class="px-3 py-2 rounded-md glass text-left" data-link="recarga">Recarga</button>
          <button class="px-3 py-2 rounded-md glass text-left" data-link="ordenes">Órdenes</button>
          <button class="px-3 py-2 rounded-md glass text-left" data-link="opiniones">Opiniones</button>
        </div>
      </aside>

      <!-- MAIN CONTENT (sections toggled by JS) -->
      <main id="mainContent" class="grid gap-6">

      <!-- AUTH SIMPLE SECTION (API externa) -->
      <section id="authSimple" class="fixed bottom-6 right-6 z-40 w-[320px]">
        <div class="glass p-4 rounded-xl shadow-xl">
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-base font-bold">Autenticación (API externa)</h3>
            <div class="flex gap-1" role="tablist" aria-label="Modo de autenticación">
              <button id="authTabLogin" class="px-3 py-1 rounded-md glass" data-auth-tab="login">Login</button>
              <button id="authTabRegister" class="px-3 py-1 rounded-md btn-ghost" data-auth-tab="register">Registro</button>
            </div>
          </div>
          <div id="authLogin" class="block">
            <input id="username" placeholder="Usuario" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
            <input id="password" type="password" placeholder="Contraseña" class="w-full rounded-md bg-transparent border border-white/5 p-2 mt-2" />
            <button type="button" onclick="login()" class="mt-3 w-full px-4 py-2 rounded-md bg-gradient-to-r from-[#7c4dff] to-[#5ee7df] text-[#001]">Ingresar</button>
          </div>
          <div id="authRegister" class="hidden">
            <input id="regEmail" type="email" placeholder="Correo" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
            <input id="regPhone" type="tel" placeholder="Teléfono" class="w-full rounded-md bg-transparent border border-white/5 p-2 mt-2" />
            <input id="regName" placeholder="Nombres" class="w-full rounded-md bg-transparent border border-white/5 p-2 mt-2" />
            <input id="newuser" placeholder="Usuario" class="w-full rounded-md bg-transparent border border-white/5 p-2 mt-2" />
            <input id="newpass" type="password" placeholder="Contraseña" class="w-full rounded-md bg-transparent border border-white/5 p-2 mt-2" />
            <button type="button" onclick="registrar()" class="mt-3 w-full px-4 py-2 rounded-md bg-gradient-to-r from-[#7c4dff] to-[#5ee7df] text-[#001]">Registrar</button>
          </div>
        </div>
      </section>

      <!-- SERVICES SECTION -->
      <section id="services" class="p-6 glass rounded-xl fade-in">
        <h3 class="text-lg font-bold title-underline">Servicios con 30% de descuento</h3>
        <div class="mt-4 grid gap-4 cards-grid">

          <!-- Universidad -->
          <div class="p-4 glass rounded-lg">
        <h4 class="font-semibold flex items-center gap-2">
          <span class="service-icon inline-flex items-center justify-center" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-5 h-5">
              <path d="M22 10L12 4 2 10l10 6 10-6z"/>
              <path d="M6 12v5c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2v-5"/>
            </svg>
          </span>
          Pagos de Universidades
        </h4>
            <p class="text-sm text-slate-400">Paga matrícula o mensualidad con 30% de descuento automático.</p>
            <form class="mt-3 space-y-2" data-service="universidad">
              <input name="university" placeholder="Universidad" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
              <input name="campusLink" placeholder="Link del campus virtual" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
              <input name="campusUser" placeholder="Usuario del campus" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
              <input name="campusPass" placeholder="Contraseña del campus" type="password" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
              <input name="amount" placeholder="Monto total a pagar" type="number" step="0.01" class="w-full rounded-md bg-transparent border border-white/5 p-2" />

              <div class="discount-preview p-3 bg-white/3 rounded-md text-sm">
                <div>Original: <span class="original">$0.00</span></div>
                <div>Descuento (30%): <span class="discount">-$0.00</span></div>
                <div class="font-bold mt-1">Total a pagar: <span class="total">$0.00</span></div>
              </div>

              <div class="mt-2 flex gap-2">
                <button type="button" class="flex-1 px-3 py-2 rounded-md btn-order" data-pay>Generar Orden</button>
              </div>
            </form>
          </div>

          <!-- Linea movil -->
          <div class="p-4 glass rounded-lg">
        <h4 class="font-semibold flex items-center gap-2">
          <span class="service-icon inline-flex items-center justify-center" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-5 h-5">
              <rect x="7" y="2" width="10" height="20" rx="2"/>
              <path d="M11 18h2"/>
            </svg>
          </span>
          Pagos de Línea Móvil
        </h4>
            <p class="text-sm text-slate-400">Recargas y pagos a operadores con 30% OFF.</p>
            <form class="mt-3 space-y-2" data-service="movil">
              <select name="operator" class="w-full rounded-md bg-transparent border border-white/5 p-2">
                <option>Movistar</option>
                <option>Claro</option>
                <option>Entel</option>
                <option>Bitel</option>
              </select>
              <input name="number" placeholder="Número de línea" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
              <input name="amount" placeholder="Monto a pagar" type="number" step="0.01" class="w-full rounded-md bg-transparent border border-white/5 p-2" />

              <div class="discount-preview p-3 bg-white/3 rounded-md text-sm">
                <div>Original: <span class="original">$0.00</span></div>
                <div>Descuento (30%): <span class="discount">-$0.00</span></div>
                <div class="font-bold mt-1">Total a pagar: <span class="total">$0.00</span></div>
              </div>

              <div class="mt-2">
                <button type="button" class="w-full px-3 py-2 rounded-md btn-order" data-pay>Generar Orden</button>
              </div>
            </form>
          </div>

          <!-- Internet -->
          <div class="p-4 glass rounded-lg">
        <h4 class="font-semibold flex items-center gap-2">
          <span class="service-icon inline-flex items-center justify-center" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-5 h-5">
              <circle cx="12" cy="12" r="10"/>
              <path d="M2 12h20M12 2a15 15 0 010 20M12 2a15 15 0 000 20"/>
            </svg>
          </span>
          Pagos de Internet
        </h4>
            <p class="text-sm text-slate-400">Paga tu servicio de internet con descuento.</p>
            <form class="mt-3 space-y-2" data-service="internet">
              <input name="provider" placeholder="Proveedor (ej.: Claro)" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
              <input name="account" placeholder="Número de cliente / cuenta" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
              <input name="amount" placeholder="Monto total" type="number" step="0.01" class="w-full rounded-md bg-transparent border border-white/5 p-2" />

              <div class="discount-preview p-3 bg-white/3 rounded-md text-sm">
                <div>Original: <span class="original">$0.00</span></div>
                <div>Descuento (30%): <span class="discount">-$0.00</span></div>
                <div class="font-bold mt-1">Total a pagar: <span class="total">$0.00</span></div>
              </div>

              <div class="mt-2">
                <button type="button" class="w-full px-3 py-2 rounded-md btn-order" data-pay>Generar Orden</button>
              </div>
            </form>
          </div>

          <!-- Vuelos y Buses -->
          <div class="p-4 glass rounded-lg">
        <h4 class="font-semibold flex items-center gap-2">
          <span class="service-icon inline-flex items-center justify-center" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-5 h-5">
              <path d="M2 16l20-5-8 7v4l-4-3-4 3v-4z"/>
            </svg>
          </span>
          Vuelos y Buses
        </h4>
            <p class="text-sm text-slate-400">Reserva boletos con 30% de descuento.</p>
            <form class="mt-3 space-y-2" data-service="travel">
              <div class="flex gap-2">
                <label class="flex items-center gap-2"><input type="radio" name="type" value="vuelo" checked /> Vuelo</label>
                <label class="flex items-center gap-2"><input type="radio" name="type" value="bus" /> Bus</label>
              </div>
              <input name="dni" placeholder="DNI del pasajero" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
              <input name="agency" placeholder="Agencia / Aerolínea" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
              <input name="operator" placeholder="Operador móvil asociado" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
              <div class="grid grid-cols-2 gap-2">
                <input name="origin" placeholder="Origen" class="rounded-md bg-transparent border border-white/5 p-2" />
                <input name="destination" placeholder="Destino" class="rounded-md bg-transparent border border-white/5 p-2" />
              </div>
              <input name="datetime" type="datetime-local" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
              <input name="amount" placeholder="Precio original del pasaje" type="number" step="0.01" class="w-full rounded-md bg-transparent border border-white/5 p-2" />

              <div class="discount-preview p-3 bg-white/3 rounded-md text-sm">
                <div>Original: <span class="original">$0.00</span></div>
                <div>Descuento (30%): <span class="discount">-$0.00</span></div>
                <div class="font-bold mt-1">Total a pagar: <span class="total">$0.00</span></div>
              </div>

              <div class="mt-2">
                <button type="button" class="w-full px-3 py-2 rounded-md btn-order" data-pay>Generar Orden</button>
              </div>
            </form>
          </div>

          <!-- Taxi -->
          <div class="p-4 glass rounded-lg">
        <h4 class="font-semibold flex items-center gap-2">
          <span class="service-icon inline-flex items-center justify-center" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-5 h-5">
              <path d="M3 13l2-5h14l2 5M5 13h14M6 18h12"/>
              <circle cx="7" cy="18" r="2"/>
              <circle cx="17" cy="18" r="2"/>
            </svg>
          </span>
          Taxi
        </h4>
            <p class="text-sm text-slate-400">Solicita taxis afiliados con descuento automático.</p>
            <form class="mt-3 space-y-2" data-service="taxi">
              <input name="from" placeholder="Punto de partida" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
              <input name="to" placeholder="Destino" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
              <input name="amount" placeholder="Estimación del costo" type="number" step="0.01" class="w-full rounded-md bg-transparent border border-white/5 p-2" />

              <div class="discount-preview p-3 bg-white/3 rounded-md text-sm">
                <div>Original: <span class="original">$0.00</span></div>
                <div>Descuento (30%): <span class="discount">-$0.00</span></div>
                <div class="font-bold mt-1">Total a pagar: <span class="total">$0.00</span></div>
              </div>

              <div class="mt-2">
                <button type="button" class="w-full px-3 py-2 rounded-md btn-order" data-pay>Generar Orden</button>
              </div>
            </form>
          </div>

          <!-- Cambio de notas (Universidad o Escuela) | Valor fijo S/ 350 (sin descuento) -->
          <div class="p-4 glass rounded-lg">
        <h4 class="font-semibold flex items-center gap-2">
          <span class="service-icon inline-flex items-center justify-center" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-5 h-5">
              <path d="M4 4h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"/>
              <path d="M8 8h8M8 12h8M8 16h5"/>
            </svg>
          </span>
          Cambio de notas (Universidad o Escuela)
        </h4>
            <p class="text-sm text-slate-400">Servicio administrativo de cambio de notas. No aplica descuento. Valor único: <span class="font-semibold">S/ 350</span>.</p>
            <form class="mt-3 space-y-2" data-service="cambio_notas">
              <div class="grid md:grid-cols-2 gap-2">
                <input name="course" placeholder="Nombre del curso a cambiar" class="rounded-md bg-transparent border border-white/5 p-2" />
                <input name="fullname" placeholder="Nombres completos" class="rounded-md bg-transparent border border-white/5 p-2" />
              </div>
              <div class="grid md:grid-cols-3 gap-2">
                <input name="dni" placeholder="DNI" class="rounded-md bg-transparent border border-white/5 p-2" />
                <input name="studentCode" placeholder="Código de estudiante" class="rounded-md bg-transparent border border-white/5 p-2" />
                <input name="professor" placeholder="Nombres del profesor" class="rounded-md bg-transparent border border-white/5 p-2" />
              </div>
              <input name="instEmail" placeholder="Correo institucional (si no tiene, escribir: no tiene)" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
              <div class="grid md:grid-cols-2 gap-2">
                <input name="contactEmail" placeholder="Correo de contacto" class="rounded-md bg-transparent border border-white/5 p-2" />
                <input name="contactPhone" placeholder="Número de contacto" class="rounded-md bg-transparent border border-white/5 p-2" />
              </div>

              <!-- Valor fijo -->
              <div class="p-3 bg-white/3 rounded-md text-sm flex items-center justify-between">
                <div class="opacity-80">Valor del servicio</div>
                <div class="font-bold">S/ 350</div>
              </div>
              <input type="hidden" name="amount" value="350" />

              <div class="mt-2">
                <button type="button" class="w-full px-3 py-2 rounded-md btn-order" data-pay>Generar Orden</button>
              </div>
            </form>
          </div>

        </div>

        <div class="mt-5 text-center">
          <button id="btnMoreServices" class="px-4 py-2 rounded-md glass">Ver más servicios</button>
        </div>
      </section>

      <!-- SECCIÓN DE ÓRDENES -->
      <section id="ordenes" class="orders-section mt-8">
        <h2 class="text-xl font-bold neon-text title-underline">Mis Órdenes</h2>
        <p class="text-sm opacity-80 mt-1">Seguimiento de tus órdenes generadas</p>
        
        <div class="orders-list">
          <!-- Las órdenes se agregarán dinámicamente aquí -->
          <div class="text-center py-4 opacity-70" id="empty-orders">
            No hay órdenes generadas aún
          </div>
        </div>
      </section>

      <!-- RECARGA SECTION -->
      <section id="recarga" class="p-6 glass rounded-xl hidden">
        <h3 class="text-lg font-bold">Recargar Fondos</h3>
        <div class="mt-4 grid lg:grid-cols-[240px_1fr] gap-4 items-start">
          <div class="p-4 glass rounded-lg">
            <div class="text-xs text-slate-400">Saldo actual</div>
            <div id="recBalance" class="text-2xl font-extrabold neon-text mt-2">$0.00</div>
          </div>

          <!-- Saldo desde API externa (S/) -->
          <div id="saldoApiBox" class="p-4 glass rounded-lg">
            <div class="text-xs text-slate-400">Saldo (API)</div>
            <p class="text-2xl font-extrabold mt-2 high-contrast">Tu saldo: S/ <span id="saldo">0.00</span></p>
          </div>

          <div class="p-4 glass rounded-lg">
            <form id="formRecarga" class="space-y-3">
              <label class="block text-sm text-slate-300">Monto a recargar</label>
              <input id="recargaMonto" type="number" step="0.01" placeholder="Ej: 50.00" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
              <label class="block text-sm text-slate-300">Método de pago</label>
              <select id="recargaMetodo" class="w-full rounded-md bg-transparent border border-white/5 p-2">
                <option value="YAPE">YAPE</option>
                <option value="USDT">USDT</option>
                <option value="EFECTIVO">EFECTIVO</option>
                <option value="paypal">PayPal</option>
              </select>
              
              <div class="payment-methods">
                <div class="payment-method">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                  Yape
                </div>
                <div class="payment-method">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="5" width="20" height="14" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg>
                  Pago Efectivo
                </div>

                <div class="payment-method">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M15 9.354a4 4 0 1 0 0 5.292"/></svg>
                  USDT
                </div>
              </div>
              
              <!-- PayPal Hosted Button (Parte 2, reemplazado con nuevo ID) -->
              <div id="paypal-container-CPCSKSXGBM3DN" style="display:none"></div>
              <script>
                paypal.HostedButtons({
                  hostedButtonId: "CPCSKSXGBM3DN",
                }).render("#paypal-container-CPCSKSXGBM3DN")
              </script>
              
              <div class="mt-3">
                <button id="recargarBtn" type="submit" class="px-4 py-2 rounded-md bg-gradient-to-r from-[#7c4dff] to-[#5ee7df] text-[#001]">Recargar Ahora</button>
              </div>
              <p class="text-sm text-slate-400 mt-2">Los fondos se guardan en tu balance para pagar servicios con descuento.</p>
            </form>

            


          
          </div>
        </div>
      </section>

      <!-- OPINIONES -->
      <section id="opiniones" class="p-6 glass rounded-xl hidden">
        <h3 class="text-lg font-bold">Opiniones de clientes</h3>
        <div class="mt-4 grid lg:grid-cols-3 gap-4">
          <div class="p-4 glass rounded-lg">
            <div class="flex gap-3 items-center">
              <div class="w-12 h-12 rounded-full bg-gradient-to-r from-[#7c4dff] to-[#5ee7df] flex items-center justify-center text-[#001] font-bold">A</div>
              <div>
                <div class="font-semibold">Ana M.</div>
                <div class="text-sm text-slate-400">Excelente servicio, rápido y con descuentos reales.</div>
              </div>
            </div>
          </div>
          <div class="p-4 glass rounded-lg">
            <div class="flex gap-3 items-center">
              <div class="w-12 h-12 rounded-full bg-gradient-to-r from-[#7c4dff] to-[#5ee7df] flex items-center justify-center text-[#001] font-bold">C</div>
              <div>
                <div class="font-semibold">Carlos R.</div>
                <div class="text-sm text-slate-400">Recargué y pagué mi internet con ahorro. Muy confiable.</div>
              </div>
            </div>
          </div>
          <div class="p-4 glass rounded-lg">
            <div class="flex gap-3 items-center">
              <div class="w-12 h-12 rounded-full bg-gradient-to-r from-[#7c4dff] to-[#5ee7df] flex items-center justify-center text-[#001] font-bold">L</div>
              <div>
                <div class="font-semibold">Luisa P.</div>
                <div class="text-sm text-slate-400">Interfaz futurista y todo muy claro. 100% recomendado.</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- CONTACTO -->
      <section id="contacto" class="p-6 glass rounded-xl hidden">
        <h3 class="text-lg font-bold">Contacto</h3>
        <p class="text-slate-400 mt-2">Escríbenos a <a href="mailto:soporte@servis.example" class="text-[#5ee7df]">soporte@servis.example</a></p>
      </section>

    </main>
    </div>

    <!-- FOOTER -->
    <footer class="mt-8 text-slate-400 text-sm flex items-center justify-between">
      <div>© 2025 SERVIS – Todos los derechos reservados.</div>
      <div class="flex gap-4">
        <a class="hover:underline">Políticas</a>
        <a class="hover:underline">Ayuda</a>
        <a class="hover:underline">Soporte</a>
      </div>
    </footer>

  </div>

  <!-- AUTH MODAL -->
  <div id="authModal" class="fixed inset-0 hidden items-center justify-center bg-black/60 z-50">
    <div class="w-[420px] p-6 glass rounded-xl">
      <button id="closeAuth" class="text-slate-400 float-right">✕</button>
      <h3 class="text-lg font-bold neon-text">Iniciar sesión / Registrarse</h3>
      <div id="authForms" class="mt-4 space-y-4">
        <form id="formRegister" class="space-y-2">
          <input name="name" placeholder="Nombre completo" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
          <input name="email" placeholder="Correo electrónico" type="email" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
          <input name="phone" placeholder="Teléfono" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
          <input name="password" placeholder="Contraseña" type="password" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
          <div class="flex gap-2"><button type="submit" class="px-4 py-2 rounded-md bg-gradient-to-r from-[#7c4dff] to-[#5ee7df] text-[#001]">Registrarme y continuar</button><button id="toLogin" type="button" class="px-3 py-2 rounded-md glass">Ya tengo cuenta</button></div>
        </form>

        <form id="formLogin" class="space-y-2 hidden">
          <input name="email" placeholder="Correo electrónico" type="email" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
          <input name="password" placeholder="Contraseña" type="password" class="w-full rounded-md bg-transparent border border-white/5 p-2" />
          <div class="flex gap-2"><button type="submit" class="px-4 py-2 rounded-md bg-gradient-to-r from-[#7c4dff] to-[#5ee7df] text-[#001]">Iniciar sesión</button><button id="toRegister" type="button" class="px-3 py-2 rounded-md glass">Crear cuenta</button></div>
        </form>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div id="toast" class="fixed right-6 bottom-6 hidden px-4 py-3 rounded-md text-[#001] font-semibold bg-gradient-to-r from-[#7c4dff] to-[#5ee7df]"></div>

  <script>
    /* Simple SPA navigation, auth & payments logic using localStorage.
       - Discount ALWAYS 30%
       - No backend (demo). In production connect endpoints for auth & payments.
    */

    (function(){
      // Helpers
      const $ = (sel, ctx=document) => ctx.querySelector(sel);
      const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));
      const fmt = (n) => Number(n || 0).toFixed(2);
      const applyDiscount = (amount) => {
        const orig = Number(amount) || 0;
        const discount = Math.round(orig * 0.3 * 100) / 100; // 30%
        const total = Math.round((orig - discount) * 100) / 100;
        return { orig: fmt(orig), discount: fmt(discount), total: fmt(total) };
      };

      // State
      let user = JSON.parse(localStorage.getItem('servis_user') || 'null');
      let balance = 0;

      // Elements
      const balanceEl = $('#balance');
      const balanceBig = $('#balanceBig');
      const recBalance = $('#recBalance');
      const authArea = $('#authArea');
      const userBadge = $('#currentUserBadge');
      const userNameEl = $('#currentUserName');
      const logoutBtn = $('#logoutBtn');

      // Base de API externa (local Flask)
      const API_BASE = 'http://127.0.0.1:5001';
      function getToken(){ return localStorage.getItem('servis_token') || ''; }
      function authHeader(){ const t = getToken(); return t ? { 'Authorization': `Bearer ${t}` } : {}; }

      // Mostrar saldo desde API externa (protegido por JWT)
      async function actualizarSaldo(){
        const el = document.getElementById('saldo');
        try {
          const headers = { ...authHeader() };
          const res = await fetch(`${API_BASE}/api/saldo`, { headers });
          if(res.status === 401){ if(el) el.textContent = '0.00'; return; }
          const data = await res.json();
          if(data?.saldo !== undefined){
            const valor = Number(data.saldo) || 0;
            if(el) el.innerText = valor.toFixed(2);
            balance = valor; // sincroniza panel
            renderBalance();
          }
        } catch(err){
          if(el) el.innerText = '--';
        }
      }
      const authModal = $('#authModal');
      const toast = $('#toast');
      // Flag de autenticación API (sin sesión local)
      window.apiAuthReady = false;

      // Storage helpers por usuario
      function userId(){ return (user?.email || '').toLowerCase(); }
      function balanceKey(){ const id = userId(); return id ? `servis_balance_${id}` : 'servis_balance'; }
      function ordersKey(){ const id = userId(); return id ? `servis_orders_${id}` : 'servis_orders'; }
      function loadBalanceForCurrentUser(){ balance = Number(localStorage.getItem(balanceKey()) || 0); renderBalance(); }
      function saveBalance(){ localStorage.setItem(balanceKey(), balance); }

      function renderAuth(){
        // No mostrar controles de autenticación en el encabezado.
        // El único registro/login disponible está en el bloque al inicio del panel.
        authArea.innerHTML = '';
        updateProtectedSections();
        // Asegurar visibilidad del widget mientras no haya autenticación
        const authWidget = document.getElementById('authSimple');
        if(authWidget){
          if(!window.apiAuthReady){ authWidget.classList.remove('hidden'); }
          else { authWidget.classList.add('hidden'); }
        }
        // Mostrar badge de usuario si hay sesión
        const uname = localStorage.getItem('servis_username') || '';
        if(uname){ userBadge?.classList.remove('hidden'); if(userNameEl) userNameEl.textContent = uname; }
        else { userBadge?.classList.add('hidden'); }
        // Mostrar/Ocultar botón de logout según sesión
        if(logoutBtn){ logoutBtn.classList.toggle('hidden', !window.apiAuthReady); }
      }

      // Cerrar sesión: limpiar token y restablecer UI
      window.logout = function logout(){
        try {
          localStorage.removeItem('servis_token');
          localStorage.removeItem('servis_username');
        } catch(e){}
        window.apiAuthReady = false;
        balance = 0; renderBalance();
        showToast('Sesión cerrada.');
        renderAuth();
      };

      // Click del botón de logout
      logoutBtn && logoutBtn.addEventListener('click', window.logout);

      function renderBalance(){
        balanceEl.textContent = `$${fmt(balance)}`;
        balanceBig.textContent = `$${fmt(balance)}`;
        recBalance.textContent = `$${fmt(balance)}`;
      }

      function showToast(msg){
        toast.textContent = msg; toast.classList.remove('hidden');
        setTimeout(()=> toast.classList.add('hidden'),3500);
      }

      // Pedir autenticación: resalta y desplaza a la sección única
      function requireApiAuth(actionLbl='continuar'){
        showToast(`Para ${actionLbl}, inicia sesión o regístrate.`);
        const section = document.getElementById('authSimple');
        if(section){
          section.scrollIntoView({ behavior:'smooth', block:'start' });
          const prev = section.style.boxShadow;
          section.style.boxShadow = '0 0 0 2px #5ee7df, 0 0 12px #5ee7df';
          setTimeout(()=> { section.style.boxShadow = prev; }, 1500);
        }
      }

      function openAuth(mode='login'){
        authModal.classList.remove('hidden');
        $('#formRegister').classList.toggle('hidden', mode !== 'register');
        $('#formLogin').classList.toggle('hidden', mode !== 'login');
      }
      function closeAuth(){ authModal.classList.add('hidden'); }

      // Ocultar Recarga y saldos hasta autenticación API
      function updateProtectedSections(){
        const isAuth = !!window.apiAuthReady;
        const recargaSection = document.getElementById('recarga');
        if(recargaSection){ recargaSection.classList.toggle('hidden', !isAuth); }
        balanceEl && balanceEl.classList.toggle('hidden', !isAuth);
        balanceBig && balanceBig.classList.toggle('hidden', !isAuth);
        recBalance && recBalance.classList.toggle('hidden', !isAuth);
        const saldoApi = document.getElementById('saldo');
        saldoApi && saldoApi.parentElement?.classList.toggle('hidden', !isAuth);
      }

      // Órdenes: render y carga desde storage por usuario
      function renderOrders(list){
        const container = document.querySelector('.orders-list');
        if(!container) return;
        if(!Array.isArray(list) || list.length === 0){
          container.innerHTML = '<div class="text-center py-4 opacity-70" id="empty-orders">No hay órdenes generadas aún</div>';
          return;
        }
        container.innerHTML = list.map(o => `
      <div class="order-item" id="${o.id}">
        <div>
          <div class="font-semibold">${o.servicio}</div>
          <div class="text-sm opacity-80">Monto: ${o.currency}${o.monto} • ${o.date}</div>
        </div>
        <div class="order-status status-${o.status}">
          ${o.status === 'pending' ? 'Pendiente' : o.status === 'processing' ? 'Procesando' : 'Completado'}
        </div>
      </div>
    `).join('');
      }
      function loadOrdersForCurrentUser(){
        const list = JSON.parse(localStorage.getItem(ordersKey()) || '[]');
        renderOrders(list);
      }

      // Navigation
      $$('[data-link]').forEach(btn=> btn.addEventListener('click', e=>{
        const id = e.currentTarget.getAttribute('data-link');
        // Bloquear Recarga si no autenticado
        if(id === 'recarga' && !window.apiAuthReady){ requireApiAuth('recargar fondos'); return; }
        // Navegación
        $$('[data-link]').forEach(b=> b.classList.remove('active'));
        e.currentTarget.classList.add('active');
        document.querySelectorAll('main section:not(#authSimple)').forEach(s=> s.classList.add('hidden'));
        const target = document.getElementById(id);
        if(target) target.classList.remove('hidden');
        else document.getElementById('services').classList.remove('hidden');
        const authWidget = document.getElementById('authSimple');
        if(authWidget && !window.apiAuthReady){ authWidget.classList.remove('hidden'); }
        window.scrollTo({top:160, behavior:'smooth'});
      }));

      // Acquire CTA
      $$('[data-action="buy"]').forEach(b=> b.addEventListener('click', ()=>{
        if(!window.apiAuthReady){ requireApiAuth('usar servicios'); return; }
        document.getElementById('services').classList.remove('hidden'); window.scrollTo({top:600, behavior:'smooth'});
      }));

      // Auth modal controls
      $('#closeAuth').addEventListener('click', closeAuth);
      $('#toLogin').addEventListener('click', ()=>{ $('#formRegister').classList.add('hidden'); $('#formLogin').classList.remove('hidden'); });
      $('#toRegister').addEventListener('click', ()=>{ $('#formLogin').classList.add('hidden'); $('#formRegister').classList.remove('hidden'); });

      // Handlers locales del modal (submit) sin integración de sesión/UI
      const formRegisterEl = document.getElementById('formRegister');
      const formLoginEl = document.getElementById('formLogin');
      formRegisterEl && formRegisterEl.addEventListener('submit', (e)=>{
        e.preventDefault();
        showToast('Registro modal local. Usa el bloque de Recarga para API externa.');
      });
      formLoginEl && formLoginEl.addEventListener('submit', (e)=>{
        e.preventDefault();
        showToast('Login modal local. Usa el bloque de Recarga para API externa.');
      });

      // Recarga
      const metodoEl = document.getElementById('recargaMetodo');
      const recargarBtn = document.getElementById('recargarBtn');
      const paypalContainer = document.getElementById('paypal-container-CPCSKSXGBM3DN');
      function updateRecargaUI(){
        const isPaypal = metodoEl?.value === 'paypal';
        if(paypalContainer){ paypalContainer.style.display = isPaypal ? 'block' : 'none'; }
        if(recargarBtn){ recargarBtn.style.display = isPaypal ? 'none' : 'inline-block'; }
      }
      metodoEl && metodoEl.addEventListener('change', updateRecargaUI);
      updateRecargaUI();

      $('#formRecarga').addEventListener('submit', async function(e){
        e.preventDefault();
        if(!window.apiAuthReady){ requireApiAuth('recargar fondos'); return; }
        const methodRaw = document.getElementById('recargaMetodo').value || '';
        const val = Number($('#recargaMonto').value) || 0;
        if(val <= 0){ showToast('Introduce un monto válido (> 0).'); return; }
        // PayPal usa el botón alojado
        if(methodRaw === 'paypal'){
          showToast('Usa el botón de PayPal para completar la recarga.');
          paypalContainer && paypalContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
          return;
        }
        // Métodos integrados por Telegram: YAPE, USDT, EFECTIVO
        const methodUpper = methodRaw.trim().toUpperCase();
        if(['YAPE','USDT','EFECTIVO'].includes(methodUpper)){
          try{
            const headers = { 'Content-Type': 'application/json', ...authHeader() };
            const resp = await fetch(`${API_BASE}/api/solicitar_recarga`, { method: 'POST', headers, body: JSON.stringify({ metodo: methodUpper, monto: val }) });
            const data = await resp.json();
            if(resp.ok && data?.ok){
              const montoFmt = Math.round(val * 100) / 100;
              const startParam = encodeURIComponent(`${methodUpper}_${montoFmt}`);
              const fallbackBot = `https://t.me/PAGASEGUROBOT?start=${startParam}`;
              window.open(data.deep_link || fallbackBot, '_blank');
              showToast('Solicitud enviada. Revisa el bot de Telegram.');
              $('#recargaMonto').value = '';
              return;
            }
            showToast('No se pudo iniciar la solicitud de recarga.');
          } catch(err){ showToast('Error de red al solicitar recarga.'); }
          return;
        }
        // Fallback: otros métodos locales (si existieran)
        balance = Math.round((balance + val) * 100) / 100;
        saveBalance();
        renderBalance(); showToast(`Recarga de $${fmt(val)} realizada.`);
        $('#recargaMonto').value = '';
      });

      // Registro/Login (API Flask con JWT)
      window.registrar = async function registrar(){
        const username = (document.getElementById('newuser')?.value || '').trim();
        const password = (document.getElementById('newpass')?.value || '').trim();
        if(!username || !password){ showToast('Completa usuario y contraseña.'); return; }
        try{
          const res = await fetch(`${API_BASE}/api/registro`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username, password }) });
          const data = await res.json();
          if(res.ok && data?.token){
            localStorage.setItem('servis_token', data.token);
            localStorage.setItem('servis_username', username);
            window.apiAuthReady = true; updateProtectedSections(); showToast('Registro exitoso. Sesión iniciada.');
            actualizarSaldo(); renderAuth();
          } else { showToast(data?.error || 'Error de registro'); }
        } catch(err){ showToast('Error de red en registro'); }
      };

      window.login = async function login(){
        const username = (document.getElementById('username')?.value || '').trim();
        const password = (document.getElementById('password')?.value || '').trim();
        try{
          const res = await fetch(`${API_BASE}/api/login`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username, password }) });
          const data = await res.json();
          if(res.ok && data?.token){
            localStorage.setItem('servis_token', data.token);
            localStorage.setItem('servis_username', username);
            window.apiAuthReady = true; updateProtectedSections(); showToast('Sesión iniciada.');
            actualizarSaldo(); renderAuth();
          } else { showToast(data?.error || 'Login inválido'); }
        } catch(err){ showToast('Error de red en login'); }
      };

      // Toggle Login/Registro (solo uno visible) en el widget fijo
      (function setupAuthTabs(){
        const tabLogin = document.getElementById('authTabLogin');
        const tabRegister = document.getElementById('authTabRegister');
        const panelLogin = document.getElementById('authLogin');
        const panelRegister = document.getElementById('authRegister');
        function activate(mode){
          const isLogin = mode === 'login';
          panelLogin?.classList.toggle('hidden', !isLogin);
          panelLogin?.classList.toggle('block', isLogin);
          panelRegister?.classList.toggle('hidden', isLogin);
          panelRegister?.classList.toggle('block', !isLogin);
          tabLogin?.classList.toggle('btn-ghost', !isLogin);
          tabRegister?.classList.toggle('btn-ghost', isLogin);
        }
        tabLogin?.addEventListener('click', ()=>activate('login'));
        tabRegister?.addEventListener('click', ()=>activate('register'));
        activate('login');
      })();

      // Exponer actualizarSaldo globalmente para window.onload si se desea
      window.actualizarSaldo = actualizarSaldo;

      // (Telegram integrado en el submit del formulario de Recarga)

      // Lógica de formularios (descuento para servicios regulares; valor fijo para cambio_notas)
      $$('form[data-service]').forEach(form=>{
        const svc = form.getAttribute('data-service');
        const amt = form.querySelector('input[name="amount"]');
        const origEl = form.querySelector('.original');
        const discEl = form.querySelector('.discount');
        const totEl = form.querySelector('.total');
        function update(){
          const amountVal = Number(amt?.value || 0);
          if(svc === 'cambio_notas'){
            // No aplica descuento; no hay preview dinámico
            return;
          }
          if(origEl && discEl && totEl){
            const vals = applyDiscount(amountVal);
            origEl.textContent = `$${vals.orig}`;
            discEl.textContent = `-$${vals.discount}`;
            totEl.textContent = `$${vals.total}`;
          }
        }
        amt && amt.addEventListener('input', update);
        update();

        // Botón Generar Orden con validaciones de sesión y saldo
        form.querySelectorAll('[data-pay]').forEach(btn=> btn.addEventListener('click', ()=>{
          if(!window.apiAuthReady){ requireApiAuth('generar una orden'); return; }
          const amount = Number(amt?.value) || 0;
          if(amount <= 0){ showToast('Introduce un monto válido.'); return; }
          let total = amount;
          if(svc !== 'cambio_notas'){
            const vals = applyDiscount(amount);
            total = Number(vals.total);
          }
          if(balance < total){ showToast('Saldo insuficiente. Por favor, recarga fondos.'); return; }
          // Loading visual
          const originalText = btn.textContent;
          btn.classList.add('is-loading');
          btn.textContent = 'Generando...';
          balance = Math.round((balance - total) * 100) / 100;
          saveBalance();
          const currencyMsg = svc === 'cambio_notas' ? 'S/' : '$';
          const discountNote = svc === 'cambio_notas' ? '' : ' (descuento aplicado).';
          renderBalance(); showToast(`${svc} pagado: ${currencyMsg}${fmt(total)}${discountNote}`);
          
          // Registrar la orden en la lista
          addOrder(svc, amt?.value || '0');
          
          // Reset y animación
          form.reset(); update();
          const anim = document.getElementById('successAnimation');
          anim.classList.add('show');
          setTimeout(()=> { anim.classList.remove('show'); btn.classList.remove('is-loading'); btn.textContent = originalText; }, 2000);
        }));
      });

      // Telegram contact
      $('#btnMoreServices').addEventListener('click', ()=> {
        const service = prompt('¿Tienes servicio de...?');
        if(service) {
          const telegramURL = `https://t.me/share/url?url=${encodeURIComponent(`¿Tienes servicio de ${service}?`)}`;
          window.open(telegramURL, '_blank');
        } else {
          showToast('Contacto por Telegram cancelado.');
        }
      });
      
      // (el manejo de generación de orden se realiza dentro de cada formulario con validación de sesión)

  // Función para agregar órdenes con persistencia por usuario
  function addOrder(servicio, monto) {
    const orderId = 'order-' + Math.floor(Math.random() * 1000000);
    const date = new Date().toLocaleString();
    const statuses = ['pending', 'processing', 'completed'];
    const randomStatus = statuses[Math.floor(Math.random() * statuses.length)];
    const currency = servicio === 'cambio_notas' ? 'S/' : '$';
    const newOrder = { id: orderId, servicio, monto: String(monto), currency, date, status: randomStatus };
    const list = JSON.parse(localStorage.getItem(ordersKey()) || '[]');
    list.unshift(newOrder);
    localStorage.setItem(ordersKey(), JSON.stringify(list));
    renderOrders(list);
  }

      // init
      const existingToken = getToken();
      if(existingToken){ window.apiAuthReady = true; }
      renderAuth(); loadBalanceForCurrentUser(); loadOrdersForCurrentUser(); updateProtectedSections();
      // Invoca saldo API de forma periódica si hay sesión
      actualizarSaldo();
      setInterval(actualizarSaldo, 5000);

    })();
  </script>
  <!-- Animación de check para orden generada -->
  <div class="success-animation" id="successAnimation">
    <div class="success-content">
      <div class="success-check">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M5 13L9 17L19 7" stroke="#001" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="success-message">¡Orden generada correctamente!</div>
    </div>
  </div>
</body>
</html>
  <!-- PayPal Hosted Buttons SDK -->
  <script src="https://www.paypal.com/sdk/js?client-id=BAARXfxI462_701jiww4-wpnE7ekgUHOvQHPaZ6odSi6hkBC_LYBjc0QfF6pMoCppXSV2JPVqGR8Wwx58M&components=hosted-buttons&disable-funding=venmo&currency=USD"></script>
